<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <link rel="alternate" href="/atom.xml" title="不积小流，无以成江海" type="application/atom+xml">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.5.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: 'AWLTH1YPN5',
      apiKey: 'd9101fc28af07d0ea8ade8654c1dc48b',
      indexName: 'test_niel',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="自从看了蒋鑫的《Git权威指南》之后就开始使用Git Submodule功能，团队也都熟悉了怎么使用，多个子系统（模块）都能及时更新到最新的公共资源，把使用的过程以及经验和容易遇到的问题分享给大家。 Git Submodule功能刚刚开始学习可能觉得有点怪异，所以本教程把每一步的操作的命令和结果都用代码的形式展现给大家，以便更好的理解。 对于公共资源各种程序员的处理方式： 每个公司的系统都会有一套">
<meta property="og:type" content="article">
<meta property="og:title" content="Git Submoudle使用完整教程">
<meta property="og:url" content="https://tnie.github.io/2018/04/02/git_submodule/index.html">
<meta property="og:site_name" content="不积小流，无以成江海">
<meta property="og:description" content="自从看了蒋鑫的《Git权威指南》之后就开始使用Git Submodule功能，团队也都熟悉了怎么使用，多个子系统（模块）都能及时更新到最新的公共资源，把使用的过程以及经验和容易遇到的问题分享给大家。 Git Submodule功能刚刚开始学习可能觉得有点怪异，所以本教程把每一步的操作的命令和结果都用代码的形式展现给大家，以便更好的理解。 对于公共资源各种程序员的处理方式： 每个公司的系统都会有一套">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2018-04-02T08:26:03.000Z">
<meta property="article:modified_time" content="2018-12-03T03:07:17.000Z">
<meta property="article:author" content="tnie &amp; ilyw">
<meta property="article:tag" content="git">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://tnie.github.io/2018/04/02/git_submodule/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Git Submoudle使用完整教程 | 不积小流，无以成江海</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">不积小流，无以成江海</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">海纳百川，有容乃大</p>
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-commonweal">

    <a href="/404/" rel="section"><i class="fa fa-fw fa-heartbeat"></i>公益 404</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tnie.github.io/2018/04/02/git_submodule/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://raw.githubusercontent.com/tnie/MarkdownPhotos/master/Baymax1.jpg">
      <meta itemprop="name" content="tnie & ilyw">
      <meta itemprop="description" content="家人是奋斗的初衷，路途艰辛时常思初心。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="不积小流，无以成江海">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Git Submoudle使用完整教程
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-02 16:26:03" itemprop="dateCreated datePublished" datetime="2018-04-02T16:26:03+08:00">2018-04-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2018-12-03 11:07:17" itemprop="dateModified" datetime="2018-12-03T11:07:17+08:00">2018-12-03</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>自从看了蒋鑫的《Git权威指南》之后就开始使用Git Submodule功能，团队也都熟悉了怎么使用，多个子系统（模块）都能及时更新到最新的公共资源，把使用的过程以及经验和容易遇到的问题分享给大家。</p>
<p>Git Submodule功能刚刚开始学习可能觉得有点怪异，所以本教程把每一步的操作的命令和结果都用代码的形式展现给大家，以便更好的理解。</p>
<p><strong>对于公共资源各种程序员的处理方式</strong>：</p>
<p>每个公司的系统都会有一套统一的系统风格，或者针对某一个大客户的多个系统风格保持统一，而且如果风格改动后要同步到多个系统中；这样的需求几乎每个开发人员都遇到，下面看看各个层次的程序员怎么处理：</p>
<p>假如对于系统的风格需要几个目录：css、images、js。</p>
<p>普通程序员，把最新版本的代码逐个复制到每个项目中，如果有N个项目，那就是要复制N x 3次；如果漏掉了某个文件夹没有复制…@（&amp;#@#。</p>
<p>文艺程序员，使用Git Submodule功能，执行：git submodule update，然后冲一杯咖啡悠哉的享受着。</p>
<a id="more"></a>

<p>引用一段《Git权威指南》的话： 项目的版本库在某些情况虾需要引用其他版本库中的文件，例如公司积累了一套常用的函数库，被多个项目调用，显然这个函数库的代码不能直接放到某个项目的代码中，而是要独立为一个代码库，那么其他项目要调用公共函数库该如何处理呢？分别把公共函数库的文件拷贝到各自的项目中会造成冗余，丢弃了公共函数库的维护历史，这显然不是好的方法。</p>
<h1 id="开始学习Git-Submodule"><a href="#开始学习Git-Submodule" class="headerlink" title="开始学习Git Submodule"></a>开始学习Git Submodule</h1><p>“工欲善其事，必先利其器”！</p>
<p>既然文艺程序员那么轻松就搞定了，那我们就把过程一一道来。</p>
<p>说明：本例采用两个项目以及两个公共类库演示对submodule的操作。因为在一写资料或者书上的例子都是一个项目对应1～N个lib，但是实际应用往往并不是这么简单。</p>
<h2 id="创建Git-Submodule测试项目"><a href="#创建Git-Submodule测试项目" class="headerlink" title="创建Git Submodule测试项目"></a>创建Git Submodule测试项目</h2><h3 id="准备环境"><a href="#准备环境" class="headerlink" title="准备环境"></a>准备环境</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~  pwd</span><br><span class="line">/home/henryyan</span><br><span class="line">mkdir -p submd/repos</span><br></pre></td></tr></table></figure>
<p>创建需要的本地仓库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cd ~/submd/repos</span><br><span class="line">git --git-dir=lib1.git init --bare</span><br><span class="line">git --git-dir=lib2.git init --bare</span><br><span class="line">git --git-dir=project1.git init --bare</span><br><span class="line">git --git-dir=project2.git init --bare</span><br></pre></td></tr></table></figure>
<p>初始化工作区：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/submd/ws</span><br><span class="line">cd ~/submd/ws</span><br></pre></td></tr></table></figure>
<h3 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h3><p>初始化project1：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws  git clone ../repos/project1.git </span><br><span class="line">Cloning into project1...</span><br><span class="line">done.</span><br><span class="line">warning: You appear to have cloned an empty repository.</span><br><span class="line"> </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws  cd project1</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) echo &quot;project1&quot; &gt; project-infos.txt</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ ls</span><br><span class="line">project-infos.txt</span><br><span class="line"> </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ git add project-infos.txt </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ git status</span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Initial commit</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Changes to be committed:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git rm --cached &lt;file&gt;...&quot;</span> to unstage)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   new file:   project-infos.txt</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ git commit -m <span class="string">&quot;init project1&quot;</span></span></span><br><span class="line">[master (root-commit) 473a2e2] init project1</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 project-infos.txt</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) git push origin master</span><br><span class="line">Counting objects: 3, done.</span><br><span class="line">Writing objects: 100% (3/3), 232 bytes, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">To /home/henryyan/submd/ws/../repos/project1.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br></pre></td></tr></table></figure>

<p>初始化project2：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 cd ..</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws  git clone ../repos/project2.git </span><br><span class="line">Cloning into project2...</span><br><span class="line">done.</span><br><span class="line">warning: You appear to have cloned an empty repository.</span><br><span class="line"> </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws  cd project2</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) echo &quot;project2&quot; &gt; project-infos.txt</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) ✗ ls</span><br><span class="line">project-infos.txt</span><br><span class="line"> </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) ✗ git add project-infos.txt </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) ✗ git status</span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Initial commit</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Changes to be committed:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git rm --cached &lt;file&gt;...&quot;</span> to unstage)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   new file:   project-infos.txt</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) ✗ git commit -m <span class="string">&quot;init project2&quot;</span></span></span><br><span class="line">[master (root-commit) 473a2e2] init project2</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 project-infos.txt</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) git push origin master</span><br><span class="line">Counting objects: 3, done.</span><br><span class="line">Writing objects: 100% (3/3), 232 bytes, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">To /home/henryyan/submd/ws/../repos/project2.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br></pre></td></tr></table></figure>

<h3 id="初始化公共类库"><a href="#初始化公共类库" class="headerlink" title="初始化公共类库"></a>初始化公共类库</h3><p>初始化公共类库lib1：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws  git clone ../repos/lib1.git </span><br><span class="line">Cloning into lib1...</span><br><span class="line">done.</span><br><span class="line">warning: You appear to have cloned an empty repository.</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws  cd lib1 </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/lib1 git:(master) echo &quot;I&#x27;m lib1.&quot; &gt; lib1-features</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/lib1 git:(master) ✗ git add lib1-features </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/lib1 git:(master) ✗ git commit -m &quot;init lib1&quot;</span><br><span class="line">[master (root-commit) c22aff8] init lib1</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 lib1-features</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/lib1 git:(master) git push origin master</span><br><span class="line">Counting objects: 3, done.</span><br><span class="line">Writing objects: 100% (3/3), 227 bytes, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">To /home/henryyan/submd/ws/../repos/lib1.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br></pre></td></tr></table></figure>

<p>初始化公共类库lib2：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/lib1 git:(master) cd ..</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws  git clone ../repos/lib2.git </span><br><span class="line">Cloning into lib2...</span><br><span class="line">done.</span><br><span class="line">warning: You appear to have cloned an empty repository.</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws  cd lib2 </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/lib2 git:(master) echo &quot;I&#x27;m lib2.&quot; &gt; lib2-features</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/lib2 git:(master) ✗ git add lib2-features </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/lib2 git:(master) ✗ git commit -m &quot;init lib2&quot;</span><br><span class="line">[master (root-commit) c22aff8] init lib2</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 lib2-features</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/lib2 git:(master) git push origin master</span><br><span class="line">Counting objects: 3, done.</span><br><span class="line">Writing objects: 100% (3/3), 227 bytes, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">To /home/henryyan/submd/ws/../repos/lib2.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br></pre></td></tr></table></figure>

<h2 id="为主项目添加Submodules"><a href="#为主项目添加Submodules" class="headerlink" title="为主项目添加Submodules"></a>为主项目添加Submodules</h2><h3 id="为project1添加lib1和lib2"><a href="#为project1添加lib1和lib2" class="headerlink" title="为project1添加lib1和lib2"></a>为project1添加lib1和lib2</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/lib2 git:(master) cd ../project1</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ls</span><br><span class="line">project-infos.txt</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) git submodule add ~/submd/repos/lib1.git libs/lib1</span><br><span class="line">Cloning into libs/lib1...</span><br><span class="line">done.</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ git submodule add ~/submd/repos/lib2.git libs/lib2</span><br><span class="line">Cloning into libs/lib2...</span><br><span class="line">done.</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ ls</span><br><span class="line">libs  project-infos.txt</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ ls libs </span><br><span class="line">lib1  lib2</span><br><span class="line"> </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ git status </span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Changes to be committed:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git reset HEAD &lt;file&gt;...&quot;</span> to unstage)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   new file:   .gitmodules</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   libs/lib1</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   libs/lib2</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看一下公共类库的内容</span></span><br><span class="line"> </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) cat libs/lib1/lib1-features</span><br><span class="line">I&#x27;m lib1.</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) cat libs/lib2/lib2-features</span><br><span class="line">I&#x27;m lib2.</span><br></pre></td></tr></table></figure>
<p>好了，到目前为止我们已经使用<strong>git submodule add</strong>命令为<strong>project1</strong>成功添加了两个公共类库（lib1、lib2），查看了当前的状态发现添加了一个新文件(<strong>.gitmodules</strong>)和两个文件夹(libs/lib1、libs/lib2)；那么新增的**.gitmodules**文件是做什么用的呢？我们查看一下文件内容便知晓了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">n@hy-hp  ~/submd/ws/project1 git:(master) ✗ cat .gitmodules </span><br><span class="line">[submodule &quot;libs/lib1&quot;]</span><br><span class="line">    path = libs/lib1</span><br><span class="line">    url = /home/henryyan/submd/repos/lib1.git</span><br><span class="line">[submodule &quot;libs/lib2&quot;]</span><br><span class="line">    path = libs/lib2</span><br><span class="line">    url = /home/henryyan/submd/repos/lib2.git</span><br></pre></td></tr></table></figure>
<p>原来如此，**.gitmodules**记录了每个submodule的引用信息，知道在当前项目的位置以及仓库的所在。</p>
<p>好的，我们现在把更改提交到仓库。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ git commit -a -m &quot;add submodules[lib1,lib2] to project1&quot;</span><br><span class="line">[master 7157977] add submodules[lib1,lib2] to project1</span><br><span class="line"> 3 files changed, 8 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 .gitmodules</span><br><span class="line"> create mode 160000 libs/lib1</span><br><span class="line"> create mode 160000 libs/lib2</span><br><span class="line"> </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) git push</span><br><span class="line">Counting objects: 5, done.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (4/4), done.</span><br><span class="line">Writing objects: 100% (4/4), 491 bytes, done.</span><br><span class="line">Total 4 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (4/4), done.</span><br><span class="line">To /home/henryyan/submd/ws/../repos/project1.git</span><br><span class="line">   45cbbcb..7157977  master -&gt; master</span><br></pre></td></tr></table></figure>

<pre><code>假如你是第一次引入公共类库的开发人员，那么项目组的其他成员怎么Clone带有Submodule的项目呢，下面我们再clone一个项目讲解如何操作。</code></pre>
<h2 id="Clone带有Submodule的仓库"><a href="#Clone带有Submodule的仓库" class="headerlink" title="Clone带有Submodule的仓库"></a>Clone带有Submodule的仓库</h2><p>模拟开发人员B……</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) cd ~/submd/ws</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws  git clone ../repos/project1.git project1-b</span><br><span class="line">Cloning into project1-b...</span><br><span class="line">done.</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws  cd project1-b </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) git submodule </span><br><span class="line">-c22aff85be91eca442734dcb07115ffe526b13a1 libs/lib1</span><br><span class="line">-7290dce0062bd77df1d83b27dd3fa3f25a836b54 libs/lib2</span><br></pre></td></tr></table></figure>
<p>看到submodules的状态是hash码和文件目录，但是注意前面有一个减号：**-**，含义是该子模块还没有检出。</p>
<p>OK，检出project1-b的submodules……</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) git submodule init</span><br><span class="line">Submodule &#x27;libs/lib1&#x27; (/home/henryyan/submd/repos/lib1.git) registered for path &#x27;libs/lib1&#x27;</span><br><span class="line">Submodule &#x27;libs/lib2&#x27; (/home/henryyan/submd/repos/lib2.git) registered for path &#x27;libs/lib2&#x27;</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) git submodule update</span><br><span class="line">Cloning into libs/lib1...</span><br><span class="line">done.</span><br><span class="line">Submodule path &#x27;libs/lib1&#x27;: checked out &#x27;c22aff85be91eca442734dcb07115ffe526b13a1&#x27;</span><br><span class="line">Cloning into libs/lib2...</span><br><span class="line">done.</span><br><span class="line">Submodule path &#x27;libs/lib2&#x27;: checked out &#x27;7290dce0062bd77df1d83b27dd3fa3f25a836b54&#x27;</span><br></pre></td></tr></table></figure>

<pre><code>读者可以查看：.git/config文件的内容，最下面有submodule的注册信息！</code></pre>
<p>验证一下类库的文件是否存在：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) cat libs/lib1/lib1-features libs/lib2/lib2-features</span><br><span class="line">I&#x27;m lib1.</span><br><span class="line">I&#x27;m lib2.</span><br></pre></td></tr></table></figure>

<pre><code>上面的两个命令(git submodule init &amp; update)其实可以简化，后面会讲到！</code></pre>
<h2 id="修改Submodule"><a href="#修改Submodule" class="headerlink" title="修改Submodule"></a>修改Submodule</h2><p>我们在开发人员B的项目上修改Submodule的内容。</p>
<p>先看一下当前Submodule的状态：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) cd libs/lib1</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b/libs/lib1  git status</span><br><span class="line"><span class="meta">#</span><span class="bash"> Not currently on any branch.</span></span><br><span class="line">nothing to commit (working directory clean)</span><br></pre></td></tr></table></figure>
<p>为什么是<strong>Not currently on any branch</strong>呢？不是应该默认在<strong>master</strong>分支吗？别急，一一解答！</p>
<p>Git对于Submodule有特殊的处理方式，在一个主项目中引入了Submodule其实Git做了3件事情：</p>
<ul>
<li><p>记录引用的仓库</p>
</li>
<li><p>记录主项目中Submodules的目录位置</p>
</li>
<li><p>记录引用Submodule的<strong>commit id</strong></p>
</li>
</ul>
<p>在<strong>project1</strong>中push之后其实就是更新了引用的commit id，然后project1-b在clone的时候获取到了submodule的commit id，然后当执行<strong>git submodule update</strong>的时候git就根据<strong>gitlink</strong>获取submodule的commit id，最后获取submodule的文件，所以clone之后不在任何分支上；但是master分支的commit id和HEAD保持一致（why?）。</p>
<p>查看~/submd/ws/project1-b/libs/lib1的引用信息：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b/libs/lib1  cat .git/HEAD</span><br><span class="line">c22aff85be91eca442734dcb07115ffe526b13a1</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b/libs/lib1  cat .git/refs/heads/master              </span><br><span class="line">c22aff85be91eca442734dcb07115ffe526b13a1</span><br></pre></td></tr></table></figure>

<p>现在我们要修改lib1的文件需要先切换到<strong>master</strong>分支：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b/libs/lib1  git checkout master</span><br><span class="line">Switched to branch &#x27;master&#x27;</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b/libs/lib1 git:(master) echo &quot;add by developer B&quot; &gt;&gt; lib1-features</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b/libs/lib1 git:(master) ✗ git commit -a -m &quot;update lib1-features by developer B&quot;</span><br><span class="line">[master 36ad12d] update lib1-features by developer B</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br></pre></td></tr></table></figure>

<p>在主项目中修改Submodule提交到仓库稍微繁琐一点，在<strong>git push</strong>之前我们先看看<strong>project1-b</strong>状态：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ git status</span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Changes not staged <span class="keyword">for</span> commit:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   modified:   libs/lib1 (new commits)</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash">no changes added to commit (use <span class="string">&quot;git add&quot;</span> and/or <span class="string">&quot;git commit -a&quot;</span>)</span></span><br></pre></td></tr></table></figure>

<p><strong>libs/lib1 (new commits)**状态表示</strong>libs/lib1<strong>有新的提交，这个比较特殊，看看</strong>project1-b**的状态：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ git diff</span><br><span class="line">diff --git a/libs/lib1 b/libs/lib1</span><br><span class="line">index c22aff8..36ad12d 160000</span><br><span class="line">--- a/libs/lib1</span><br><span class="line">+++ b/libs/lib1</span><br><span class="line">@@ -1 +1 @@</span><br><span class="line">-Subproject commit c22aff85be91eca442734dcb07115ffe526b13a1</span><br><span class="line">+Subproject commit 36ad12d40d8a41a4a88a64add27bd57cf56c9de2</span><br></pre></td></tr></table></figure>

<p>从状态中可以看出<strong>libs/lib1</strong>的commit id由原来的<strong>c22aff85be91eca442734dcb07115ffe526b13a1</strong>更改为<strong>36ad12d40d8a41a4a88a64add27bd57cf56c9de2</strong></p>
<p>注意：如果现在执行了git submodule update操作那么libs/lib1的commit id又会还原到c22aff85be91eca442734dcb07115ffe526b13a1，</p>
<p>这样的话刚刚的修改是不是就丢死了呢？不会，因为修改已经提交到了master分支，只要再git checkout master就可以了。</p>
<p>现在可以把<strong>libs/lib1</strong>的修改提交到仓库了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ cd libs/lib1</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b/libs/lib1 git:(master) git push</span><br><span class="line">Counting objects: 5, done.</span><br><span class="line">Writing objects: 100% (3/3), 300 bytes, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">To /home/henryyan/submd/repos/lib1.git</span><br><span class="line">   c22aff8..36ad12d  master -&gt; master</span><br></pre></td></tr></table></figure>

<p>现在仅仅只完成了一步，下一步要提交<strong>project1-b</strong>引用submodule的commit id：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b/libs/lib1 git:(master) cd ~/submd/ws/project1-b</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ git add -u</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ git commit -m &quot;update libs/lib1 to lastest commit id&quot;</span><br><span class="line">[master c96838a] update libs/lib1 to lastest commit id</span><br><span class="line"> 1 files changed, 1 insertions(+), 1 deletions(-)</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) git push</span><br><span class="line">Counting objects: 5, done.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (3/3), done.</span><br><span class="line">Writing objects: 100% (3/3), 395 bytes, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">To /home/henryyan/submd/ws/../repos/project1.git</span><br><span class="line">   7157977..c96838a  master -&gt; master</span><br></pre></td></tr></table></figure>

<p>OK，大功高成，我们完成了Submodule的修改并把<strong>libs/lib1</strong>的最新commit id提交到了仓库。</p>
<p>接下来要看看<strong>project1</strong>怎么获取submodule了。</p>
<h2 id="更新主项目的Submodules"><a href="#更新主项目的Submodules" class="headerlink" title="更新主项目的Submodules"></a>更新主项目的Submodules</h2><p>好的，让我们先进入<strong>project1</strong>目录同步仓库：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) cd ../project1</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) git pull</span><br><span class="line">remote: Counting objects: 5, done.</span><br><span class="line">remote: Compressing objects: 100% (3/3), done.</span><br><span class="line">remote: Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">From /home/henryyan/submd/ws/../repos/project1</span><br><span class="line">   7157977..c96838a  master     -&gt; origin/master</span><br><span class="line">Updating 7157977..c96838a</span><br><span class="line">Fast-forward</span><br><span class="line"> libs/lib1 |    2 +-</span><br><span class="line"> 1 files changed, 1 insertions(+), 1 deletions(-)</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ git status</span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Changes not staged <span class="keyword">for</span> commit:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   modified:   libs/lib1 (new commits)</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash">no changes added to commit (use <span class="string">&quot;git add&quot;</span> and/or <span class="string">&quot;git commit -a&quot;</span>)</span></span><br></pre></td></tr></table></figure>

<p>我们运行了<strong>git pull</strong>命令和<strong>git status</strong>获取了最新的仓库源码，然后看到了状态时<strong>modified</strong>，这是为什么呢？</p>
<p>我们用<strong>git diff</strong>比较一下不同：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ git diff</span><br><span class="line">diff --git a/libs/lib1 b/libs/lib1</span><br><span class="line">index 36ad12d..c22aff8 160000</span><br><span class="line">--- a/libs/lib1</span><br><span class="line">+++ b/libs/lib1</span><br><span class="line">@@ -1 +1 @@</span><br><span class="line">-Subproject commit 36ad12d40d8a41a4a88a64add27bd57cf56c9de2</span><br><span class="line">+Subproject commit c22aff85be91eca442734dcb07115ffe526b13a1</span><br></pre></td></tr></table></figure>

<p>从diff的结果分析出来时因为submodule的commit id更改了，我们前面刚刚讲了要在主项目更新submodule的内容首先要提交submdoule的内容，然后再更新主项目中引用的submodulecommit id；现在我们看到的不同就是因为刚刚更改了project1-b的submodule commit id；好的，我来学习一下怎么更新<strong>project1</strong>的公共类库。</p>
<p>follow me……</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ git submodule update</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ git status</span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Changes not staged <span class="keyword">for</span> commit:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   modified:   libs/lib1 (new commits)</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash">no changes added to commit (use <span class="string">&quot;git add&quot;</span> and/or <span class="string">&quot;git commit -a&quot;</span>)</span></span><br></pre></td></tr></table></figure>

<p>泥马，为什么没有更新？<strong>git submodule update</strong>命令不是更新子模块仓库的吗？</p>
<p>别急，先听我解释；因为子模块是在<strong>project1</strong>中引入的，<strong>git submodule add ~/submd/repos/lib1.git libs/lib1</strong>命令的结果，操作之后git只是把lib1的内容clone到了<strong>project1</strong>中，但是没有在仓库注册，证据如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd2/ws/project1 git:(master) ✗ cat .git/config</span><br><span class="line">[core]</span><br><span class="line">    repositoryformatversion = 0</span><br><span class="line">    filemode = true</span><br><span class="line">    bare = false</span><br><span class="line">    logallrefupdates = true</span><br><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">    fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">    url = /home/henryyan/submd/ws/../repos/project1.git</span><br><span class="line">[branch &quot;master&quot;]</span><br><span class="line">    remote = origin</span><br><span class="line">    merge = refs/heads/master</span><br></pre></td></tr></table></figure>

<p>我们说过<strong>git submodule init</strong>就是在**.git/config**中注册子模块的信息，下面我们试试注册之后再更新子模块：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ git submodule init</span><br><span class="line">Submodule &#x27;libs/lib1&#x27; (/home/henryyan/submd/repos/lib1.git) registered for path &#x27;libs/lib1&#x27;</span><br><span class="line">Submodule &#x27;libs/lib2&#x27; (/home/henryyan/submd/repos/lib2.git) registered for path &#x27;libs/lib2&#x27;</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ git submodule update</span><br><span class="line">remote: Counting objects: 5, done.</span><br><span class="line">remote: Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">From /home/henryyan/submd/repos/lib1</span><br><span class="line">   c22aff8..36ad12d  master     -&gt; origin/master</span><br><span class="line">Submodule path &#x27;libs/lib1&#x27;: checked out &#x27;36ad12d40d8a41a4a88a64add27bd57cf56c9de2&#x27;</span><br><span class="line"> </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) cat .git/config</span><br><span class="line">[core]</span><br><span class="line">    repositoryformatversion = 0</span><br><span class="line">    filemode = true</span><br><span class="line">    bare = false</span><br><span class="line">    logallrefupdates = true</span><br><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">    fetch = +refs/heads/*:refs/remotes/origin/*</span><br><span class="line">    url = /home/henryyan/submd/ws/../repos/project1.git</span><br><span class="line">[branch &quot;master&quot;]</span><br><span class="line">    remote = origin</span><br><span class="line">    merge = refs/heads/master</span><br><span class="line">[submodule &quot;libs/lib1&quot;]</span><br><span class="line">    url = /home/henryyan/submd/repos/lib1.git</span><br><span class="line">[submodule &quot;libs/lib2&quot;]</span><br><span class="line">    url = /home/henryyan/submd/repos/lib2.git</span><br><span class="line"> </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) cat libs/lib1/lib1-features</span><br><span class="line">I&#x27;m lib1.</span><br><span class="line">add by developer B</span><br></pre></td></tr></table></figure>

<p>上面的结果足以证明刚刚的推断，所以记得当需要更新子模块的内容时请先确保已经运行过<strong>git submodule init</strong>。</p>
<h2 id="为project2添加lib1和lib2"><a href="#为project2添加lib1和lib2" class="headerlink" title="为project2添加lib1和lib2"></a>为project2添加lib1和lib2</h2><p>这个操作对于读到这里的你来说应该是<strong>轻车熟路</strong>了，action：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) cd ~/submd/ws/project2</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) git submodule add ~/submd/repos/lib1.git libs/lib1</span><br><span class="line">Cloning into libs/lib1...</span><br><span class="line">done.</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) ✗ git submodule add ~/submd/repos/lib2.git libs/lib2</span><br><span class="line">zsh: correct &#x27;libs/lib2&#x27; to &#x27;libs/lib1&#x27; [nyae]? n</span><br><span class="line">Cloning into libs/lib2...</span><br><span class="line">done.</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) ✗ ls</span><br><span class="line">libs  project-infos.txt</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) ✗ git submodule init</span><br><span class="line">Submodule &#x27;libs/lib1&#x27; (/home/henryyan/submd/repos/lib1.git) registered for path &#x27;libs/lib1&#x27;</span><br><span class="line">Submodule &#x27;libs/lib2&#x27; (/home/henryyan/submd/repos/lib2.git) registered for path &#x27;libs/lib2&#x27;</span><br><span class="line"> </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) ✗ git status</span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Changes to be committed:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git reset HEAD &lt;file&gt;...&quot;</span> to unstage)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   new file:   .gitmodules</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   libs/lib1</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   new file:   libs/lib2</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) ✗ git commit -a -m <span class="string">&quot;add lib1 and lib2&quot;</span></span></span><br><span class="line">[master 8dc697f] add lib1 and lib2</span><br><span class="line"> 3 files changed, 8 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 .gitmodules</span><br><span class="line"> create mode 160000 libs/lib1</span><br><span class="line"> create mode 160000 libs/lib2</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) git push</span><br><span class="line">Counting objects: 5, done.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (4/4), done.</span><br><span class="line">Writing objects: 100% (4/4), 471 bytes, done.</span><br><span class="line">Total 4 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (4/4), done.</span><br><span class="line">To /home/henryyan/submd/ws/../repos/project2.git</span><br><span class="line">   6e15c68..8dc697f  master -&gt; master</span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<p>我们依次执行了添加submodule并commit和push到仓库，此阶段任务完成。</p>
<h2 id="修改lib1和lib2并同步到project1和project2"><a href="#修改lib1和lib2并同步到project1和project2" class="headerlink" title="修改lib1和lib2并同步到project1和project2"></a>修改lib1和lib2并同步到project1和project2</h2><p>假如开发人员C同时负责<strong>project1</strong>和<strong>project2</strong>，有可能在修改<strong>project1</strong>的某个功能的时候发现lib1或者lib2的某个组件有bug需要修复，这个需求多模块和大型系统中经常遇到，我们应该怎么解决呢？</p>
<p>假如我的需求如下：</p>
<ul>
<li><p>在lib1中添加一个文件：README，用来描述lib1的功能</p>
</li>
<li><p>在lib2中的lib2-features文件中添加一写文字：学习Git submodule的修改并同步功能</p>
</li>
</ul>
<h3 id="在lib1中添加一个文件：README"><a href="#在lib1中添加一个文件：README" class="headerlink" title="在lib1中添加一个文件：README"></a>在lib1中添加一个文件：README</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) cd libs/lib1</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2/libs/lib1 git:(master) echo &quot;lib1 readme contents&quot; &gt; README</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2/libs/lib1 git:(master) ✗ git add README </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2/libs/lib1 git:(master) ✗ git commit -m &quot;add file README&quot;</span><br><span class="line">[master 8c666d8] add file README</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 README</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2/libs/lib1 git:(master) git push</span><br><span class="line">Counting objects: 4, done.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (3/3), 310 bytes, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">To /home/henryyan/submd/repos/lib1.git</span><br><span class="line">   36ad12d..8c666d8  master -&gt; master</span><br></pre></td></tr></table></figure>

<p>前面提到过现在仅仅只完成了一部分，我们需要在<strong>project2</strong>中再更新lib1的commit id：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) ✗ git status </span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Changes not staged <span class="keyword">for</span> commit:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   modified:   libs/lib1 (new commits)</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash">no changes added to commit (use <span class="string">&quot;git add&quot;</span> and/or <span class="string">&quot;git commit -a&quot;</span>)</span></span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) ✗ git add libs/lib1</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) ✗ git commit -m &quot;update lib1 to lastest commit id&quot;</span><br><span class="line">[master ce1f3ba] update lib1 to lastest commit id</span><br><span class="line"> 1 files changed, 1 insertions(+), 1 deletions(-)</span><br></pre></td></tr></table></figure>

<pre><code>我们暂时不push到仓库，等待和lib2的修改一起push。</code></pre>
<h3 id="在lib2中的lib2-features文件添加文字"><a href="#在lib2中的lib2-features文件添加文字" class="headerlink" title="在lib2中的lib2-features文件添加文字"></a>在lib2中的lib2-features文件添加文字</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) cd libs/lib2</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2/libs/lib2 git:(master) echo &quot;学习Git submodule的修改并同步功能&quot; &gt;&gt; lib2-features </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2/libs/lib2 git:(master) ✗ git add lib2-features </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2/libs/lib2 git:(master) ✗ git commit -m &quot;添加文字：学习Git submodule的修改并同步功能&quot;</span><br><span class="line">[master e372b21] 添加文字：学习Git submodule的修改并同步功能</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2/libs/lib2 git:(master) git push</span><br><span class="line">Counting objects: 5, done.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (3/3), 376 bytes, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">To /home/henryyan/submd/repos/lib2.git</span><br><span class="line">   7290dce..e372b21  master -&gt; master</span><br><span class="line"> </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2/libs/lib2 git:(master) echo &quot;学习Git submodule的修改并同步功能&quot; &gt;&gt; lib2-features </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2/libs/lib2 git:(master) ✗ git add lib2-features </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2/libs/lib2 git:(master) ✗ git commit -m &quot;添加文字：学习Git submodule的修改并同步功能&quot;</span><br><span class="line">[master e372b21] 添加文字：学习Git submodule的修改并同步功能</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2/libs/lib2 git:(master) git push</span><br><span class="line">Counting objects: 5, done.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (3/3), 376 bytes, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">To /home/henryyan/submd/repos/lib2.git</span><br><span class="line">   7290dce..e372b21  master -&gt; master</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2/libs/lib2 git:(master) cd -</span><br><span class="line">~/submd/ws/project2</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) ✗ git status </span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Your branch is ahead of <span class="string">&#x27;origin/master&#x27;</span> by 1 commit.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Changes not staged for commit:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   modified:   libs/lib2 (new commits)</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash">no changes added to commit (use <span class="string">&quot;git add&quot;</span> and/or <span class="string">&quot;git commit -a&quot;</span>)</span></span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) ✗ git add libs/lib2 </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) ✗ git commit -m &quot;update lib2 to lastest commit id&quot;</span><br><span class="line">[master df344c5] update lib2 to lastest commit id</span><br><span class="line"> 1 files changed, 1 insertions(+), 1 deletions(-)</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) git status </span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Your branch is ahead of <span class="string">&#x27;origin/master&#x27;</span> by 2 commits.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash">nothing to commit (working directory clean)</span></span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) git push</span><br><span class="line">Counting objects: 8, done.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (6/6), done.</span><br><span class="line">Writing objects: 100% (6/6), 776 bytes, done.</span><br><span class="line">Total 6 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (6/6), done.</span><br><span class="line">To /home/henryyan/submd/ws/../repos/project2.git</span><br><span class="line">   8dc697f..df344c5  master -&gt; master</span><br></pre></td></tr></table></figure>

<h2 id="同步project2的lib1和lib2的修改到project1"><a href="#同步project2的lib1和lib2的修改到project1" class="headerlink" title="同步project2的lib1和lib2的修改到project1"></a>同步project2的lib1和lib2的修改到project1</h2><p>现在project2已经享受到了最新的代码带来的<strong>快乐</strong>，那么既然project1和project2属于同一个风格，或者调用同一个功能，要让这两个(可能几十个)项目保持一致。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) cd ../project1</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) git pull</span><br><span class="line">Already up-to-date.</span><br></pre></td></tr></table></figure>

<p>看看上面的结果对吗？为什么lib1和lib2更新了但是没有显示<strong>new commits</strong>呢？说到这里我记得刚刚开始学习的时候真得要晕死了，Git跟我玩捉迷藏游戏，为什么我明明提交了但是从<strong>project1</strong>更新不到任何改动呢？</p>
<p>帮大家分析一下问题，不过在分析之前先看看当前(project1和project2)的submodule状态：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> project2 的状态，也就是我们刚刚修改后的状态</span></span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project2 git:(master) git submodule </span><br><span class="line"> 8c666d86531513dd1aebdf235f142adbac72c035 libs/lib1 (heads/master)</span><br><span class="line"> e372b21dffa611802c282278ec916b5418acebc2 libs/lib2 (heads/master)</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> project1 的状态，等待更新submodules</span></span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) git submodule </span><br><span class="line"> 36ad12d40d8a41a4a88a64add27bd57cf56c9de2 libs/lib1 (remotes/origin/HEAD)</span><br><span class="line"> 7290dce0062bd77df1d83b27dd3fa3f25a836b54 libs/lib2 (heads/master)</span><br></pre></td></tr></table></figure>

<p>两个项目有两个区别：</p>
<ul>
<li><p>commit id各不相同</p>
</li>
<li><p><strong>libs/lib1</strong>所处的分支不同</p>
</li>
</ul>
<h3 id="更新project1的lib1和lib2改动"><a href="#更新project1的lib1和lib2改动" class="headerlink" title="更新project1的lib1和lib2改动"></a>更新project1的lib1和lib2改动</h3><p>我们还记得刚刚在<strong>project2</strong>中修改的时候把lib1和lib2都切换到了master分支，目前project1中的lib1不在任何分支，我们先切换到master分支：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) cd libs/lib1</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1/libs/lib1  git checkout master</span><br><span class="line">Previous HEAD position was 36ad12d... update lib1-features by developer B</span><br><span class="line">Switched to branch &#x27;master&#x27;</span><br><span class="line">Your branch is behind &#x27;origin/master&#x27; by 1 commit, and can be fast-forwarded.</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1/libs/lib1 git:(master) git pull</span><br><span class="line">remote: Counting objects: 4, done.</span><br><span class="line">remote: Compressing objects: 100% (2/2), done.</span><br><span class="line">remote: Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">From /home/henryyan/submd/repos/lib1</span><br><span class="line">   36ad12d..8c666d8  master     -&gt; origin/master</span><br><span class="line">Updating c22aff8..8c666d8</span><br><span class="line">Fast-forward</span><br><span class="line"> README        |    1 +</span><br><span class="line"> lib1-features |    1 +</span><br><span class="line"> 2 files changed, 2 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 README</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1/libs/lib1 git:(master) </span><br></pre></td></tr></table></figure>

<p>果不其然，我们看到了刚刚在project2中修改的内容，同步到了project1中，当然现在更新了<strong>project1</strong>的<strong>lib1</strong>，commit id也会随之变动：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1/libs/lib1 git:(master) cd ../../</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ git status </span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Changes not staged <span class="keyword">for</span> commit:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   modified:   libs/lib1 (new commits)</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash">no changes added to commit (use <span class="string">&quot;git add&quot;</span> and/or <span class="string">&quot;git commit -a&quot;</span>)</span></span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ git diff</span><br><span class="line">diff --git a/libs/lib1 b/libs/lib1</span><br><span class="line">index 36ad12d..8c666d8 160000</span><br><span class="line">--- a/libs/lib1</span><br><span class="line">+++ b/libs/lib1</span><br><span class="line">@@ -1 +1 @@</span><br><span class="line">-Subproject commit 36ad12d40d8a41a4a88a64add27bd57cf56c9de2</span><br><span class="line">+Subproject commit 8c666d86531513dd1aebdf235f142adbac72c035</span><br></pre></td></tr></table></figure>

<p>现在最新的commit id和project2目前的状态一致，说明真的同步了；好的，现在可以使用相同的办法更新<strong>lib2</strong>了：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ cd libs/lib2</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1/libs/lib2 git:(master) git pull</span><br><span class="line">remote: Counting objects: 5, done.</span><br><span class="line">remote: Compressing objects: 100% (2/2), done.</span><br><span class="line">remote: Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">From /home/henryyan/submd/repos/lib2</span><br><span class="line">   7290dce..e372b21  master     -&gt; origin/master</span><br><span class="line">Updating 7290dce..e372b21</span><br><span class="line">Fast-forward</span><br><span class="line"> lib2-features |    1 +</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br></pre></td></tr></table></figure>

<h3 id="更新project1的submodule引用"><a href="#更新project1的submodule引用" class="headerlink" title="更新project1的submodule引用"></a>更新project1的submodule引用</h3><p>在<strong>2.7.1</strong>中我们更新了<strong>project1</strong>的<strong>lib1</strong>和<strong>lib2</strong>的最新版本，现在要把最新的commit id保存到<strong>project1</strong>中以保持最新的引用。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ git status</span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Changes not staged <span class="keyword">for</span> commit:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   modified:   libs/lib1 (new commits)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   modified:   libs/lib2 (new commits)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash">no changes added to commit (use <span class="string">&quot;git add&quot;</span> and/or <span class="string">&quot;git commit -a&quot;</span>)</span></span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) ✗ git commit -a -m &quot;update lib1 and lib2 commit id to new version&quot;</span><br><span class="line">[master 8fcca50] update lib1 and lib2 commit id to new version</span><br><span class="line"> 2 files changed, 2 insertions(+), 2 deletions(-)</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1 git:(master) git push</span><br><span class="line">Counting objects: 5, done.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (3/3), done.</span><br><span class="line">Writing objects: 100% (3/3), 397 bytes, done.</span><br><span class="line">Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">To /home/henryyan/submd/ws/../repos/project1.git</span><br><span class="line">   c96838a..8fcca50  master -&gt; master</span><br></pre></td></tr></table></figure>

<h2 id="更新project1-b项目的子模块-使用脚本"><a href="#更新project1-b项目的子模块-使用脚本" class="headerlink" title="更新project1-b项目的子模块(使用脚本)"></a>更新project1-b项目的子模块(使用脚本)</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) git pull</span><br><span class="line">remote: Counting objects: 5, done.</span><br><span class="line">remote: Compressing objects: 100% (3/3), done.</span><br><span class="line">remote: Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">From /home/henryyan/submd/ws/../repos/project1</span><br><span class="line">   c96838a..8fcca50  master     -&gt; origin/master</span><br><span class="line">Updating c96838a..8fcca50</span><br><span class="line">Fast-forward</span><br><span class="line"> libs/lib1 |    2 +-</span><br><span class="line"> libs/lib2 |    2 +-</span><br><span class="line"> 2 files changed, 2 insertions(+), 2 deletions(-)</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ git status</span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Changes not staged <span class="keyword">for</span> commit:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to update what will be committed)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   modified:   libs/lib1 (new commits)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   modified:   libs/lib2 (new commits)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash">no changes added to commit (use <span class="string">&quot;git add&quot;</span> and/or <span class="string">&quot;git commit -a&quot;</span>)</span></span><br></pre></td></tr></table></figure>

<p>Git提示lib1和lib2有更新内容，这个判断的依据来源于submodule commit id的引用。</p>
<p>现在怎么更新呢？难道还是像project1中那样进入子模块的目录然后<strong>git checkout master</strong>，接着<strong>git pull</strong>？</p>
<p>而且现在仅仅才两个子模块、两个项目，如果在真实的项目中使用的话可能几个到几十个不等，再加上N个submodule，自己算一下要怎么更新多少个submodules？</p>
<p>例如笔者现在做的一个项目有<strong>5</strong>个web模块，每个web模块引用公共的css、js、images、jsp资源，这样就有20个submodule需要更新！！！</p>
<p><strong>工欲善其事，必先利其器</strong>，写一个脚本代替手动任务。</p>
<h3 id="牛刀小试"><a href="#牛刀小试" class="headerlink" title="牛刀小试"></a>牛刀小试</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ grep path .gitmodules | awk &#x27;&#123; print $3 &#125;&#x27; &gt; /tmp/study-git-submodule-dirs</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ cat /tmp/study-git-submodule-dirs</span><br><span class="line"> libs/lib1</span><br><span class="line"> libs/lib2</span><br></pre></td></tr></table></figure>

<p>我们通过分析**.gitmodules**文件得出子模块的路径，然后就可以根据这些路径进行更新。</p>
<h3 id="上路"><a href="#上路" class="headerlink" title="上路"></a>上路</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ mkdir bin</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ vi bin/update-submodules.sh</span><br></pre></td></tr></table></figure>

<p>把下面的脚本复制到<strong>bin/update-submodules.sh</strong>中：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">grep path .gitmodules | awk &#x27;&#123; print $3 &#125;&#x27; &gt; /tmp/study-git-submodule-dirs</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">read</span></span></span><br><span class="line">while read LINE</span><br><span class="line">do</span><br><span class="line">    echo $LINE</span><br><span class="line">    (cd ./$LINE &amp;&amp; git checkout master &amp;&amp; git pull)</span><br><span class="line">done &lt; /tmp/study-git-submodule-dirs</span><br></pre></td></tr></table></figure>

<p>稍微解释一下上面的脚本执行过程：</p>
<ul>
<li><p>首先把子模块的路径写入到文件**/tmp/study-git-submodule-dirs**中；</p>
</li>
<li><p>然后读取文件中的子模块路径，依次切换到master分支(修改都是在master分支上进行的)，最后更新最近改动。</p>
</li>
</ul>
<h3 id="2013-01-19更新"><a href="#2013-01-19更新" class="headerlink" title="2013-01-19更新"></a><font color="red">2013-01-19更新</font></h3><p>网友**@紫煌<strong>给出了更好的办法，一个命令就可以代替上面的</strong>bin/update-submodules.sh**的功能：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git submodule foreach git pull</span><br></pre></td></tr></table></figure>

<p>此命令也脚本一样，循环进入（enter）每个子模块的目录，然后执行<strong>foreach</strong>后面的命令。</p>
<blockquote>
<p>该后面的命令可以任意的，例如 git submodule foreach ls -l 可以列出每个子模块的文件列表</p>
</blockquote>
<h3 id="体验工具带来的便利"><a href="#体验工具带来的便利" class="headerlink" title="体验工具带来的便利"></a>体验工具带来的便利</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ git submodule </span><br><span class="line">+36ad12d40d8a41a4a88a64add27bd57cf56c9de2 libs/lib1 (heads/master)</span><br><span class="line">+7290dce0062bd77df1d83b27dd3fa3f25a836b54 libs/lib2 (heads/master)</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加执行权限</span></span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ chmod +x ./bin/update-submodules.sh</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ ./bin/update-submodules.sh </span><br><span class="line">libs/lib1</span><br><span class="line">Already on &#x27;master&#x27;</span><br><span class="line">remote: Counting objects: 4, done.</span><br><span class="line">remote: Compressing objects: 100% (2/2), done.</span><br><span class="line">remote: Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">From /home/henryyan/submd/repos/lib1</span><br><span class="line">   36ad12d..8c666d8  master     -&gt; origin/master</span><br><span class="line">Updating 36ad12d..8c666d8</span><br><span class="line">Fast-forward</span><br><span class="line"> README |    1 +</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 README</span><br><span class="line">libs/lib2</span><br><span class="line">Switched to branch &#x27;master&#x27;</span><br><span class="line">remote: Counting objects: 5, done.</span><br><span class="line">remote: Compressing objects: 100% (2/2), done.</span><br><span class="line">remote: Total 3 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (3/3), done.</span><br><span class="line">From /home/henryyan/submd/repos/lib2</span><br><span class="line">   7290dce..e372b21  master     -&gt; origin/master</span><br><span class="line">Updating 7290dce..e372b21</span><br><span class="line">Fast-forward</span><br><span class="line"> lib2-features |    1 +</span><br><span class="line"> 1 files changed, 1 insertions(+), 0 deletions(-)</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ git submodule </span><br><span class="line"> 8c666d86531513dd1aebdf235f142adbac72c035 libs/lib1 (heads/master)</span><br><span class="line"> e372b21dffa611802c282278ec916b5418acebc2 libs/lib2 (heads/master)</span><br><span class="line"> </span><br><span class="line"> ➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ git status </span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Untracked files:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git add &lt;file&gt;...&quot;</span> to include <span class="keyword">in</span> what will be committed)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   bin/</span></span></span><br><span class="line">nothing added to commit but untracked files present (use &quot;git add&quot; to track)</span><br></pre></td></tr></table></figure>

<p>更新之后的两个变化：</p>
<ul>
<li><p>git submodule的结果和project2的submodule commit id保持一致；</p>
</li>
<li><p><strong>project1-b</strong>不再提示<strong>new commits</strong>了。</p>
</li>
</ul>
<p>现在可以把工具添加到仓库了，当然你可以很骄傲的分享给其他项目组的同事。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ git add bin/update-submodules.sh </span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) ✗ git commit -m &quot;添加自动更新submodule的快捷脚本^_^&quot;</span><br><span class="line">[master 756e788] 添加自动更新submodule的快捷脚本^_^</span><br><span class="line"> 1 files changed, 9 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100755 bin/update-submodules.sh</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-b git:(master) git push</span><br><span class="line">Counting objects: 5, done.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (3/3), done.</span><br><span class="line">Writing objects: 100% (4/4), 625 bytes, done.</span><br><span class="line">Total 4 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (4/4), done.</span><br><span class="line">To /home/henryyan/submd/ws/../repos/project1.git</span><br><span class="line">   8fcca50..756e788  master -&gt; master</span><br></pre></td></tr></table></figure>

<h2 id="新进员工加入团队，一次性Clone项目和Submodules"><a href="#新进员工加入团队，一次性Clone项目和Submodules" class="headerlink" title="新进员工加入团队，一次性Clone项目和Submodules"></a>新进员工加入团队，一次性Clone项目和Submodules</h2><p>一般人使用的时候都是使用如下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone /path/to/repos/foo.git</span><br><span class="line">git submodule init</span><br><span class="line">git submodule update</span><br></pre></td></tr></table></figure>

<pre><code>新员工不耐烦了，嘴上不说但是心里想：怎么那么麻烦？</code></pre>
<p>上面的命令简直弱暴了，直接一行命令搞定：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone --recursive /path/to/repos/foo.git</span><br></pre></td></tr></table></figure>

<p>–<strong>recursive</strong>参数的含义：可以在clone项目时同时clone关联的submodules。</p>
<p>git help 对其解释：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--recursive, --recurse-submodules</span><br><span class="line">   After the clone is created, initialize all submodules within, using their default settings. This is equivalent to running git</span><br><span class="line">   submodule update --init --recursive immediately after the clone is finished. This option is ignored if the cloned repository</span><br><span class="line">   does not have a worktree&#x2F;checkout (i.e. if any of --no-checkout&#x2F;-n, --bare, or --mirror is given)</span><br></pre></td></tr></table></figure>

<h3 id="使用一键方式克隆project2"><a href="#使用一键方式克隆project2" class="headerlink" title="使用一键方式克隆project2"></a>使用一键方式克隆project2</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws  git clone --recursive ../repos/project2.git project2-auto-clone-submodules</span><br><span class="line">Cloning into project2-auto-clone-submodules...</span><br><span class="line">done.</span><br><span class="line">Submodule &#x27;libs/lib1&#x27; (/home/henryyan/submd/repos/lib1.git) registered for path &#x27;libs/lib1&#x27;</span><br><span class="line">Submodule &#x27;libs/lib2&#x27; (/home/henryyan/submd/repos/lib2.git) registered for path &#x27;libs/lib2&#x27;</span><br><span class="line">Cloning into libs/lib1...</span><br><span class="line">done.</span><br><span class="line">Submodule path &#x27;libs/lib1&#x27;: checked out &#x27;8c666d86531513dd1aebdf235f142adbac72c035&#x27;</span><br><span class="line">Cloning into libs/lib2...</span><br><span class="line">done.</span><br><span class="line">Submodule path &#x27;libs/lib2&#x27;: checked out &#x27;e372b21dffa611802c282278ec916b5418acebc2&#x27;</span><br></pre></td></tr></table></figure>

<p>舒服……</p>
<h1 id="移除Submodule"><a href="#移除Submodule" class="headerlink" title="移除Submodule"></a>移除Submodule</h1><p><strong>牢骚</strong>：搞不明白为什么git不设计一个类似：git submodule remove的命令呢？</p>
<p>我们从project1.git克隆一个项目用来练习移除submodule：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws  git clone --recursive ../repos/project1.git project1-remove-submodules</span><br><span class="line">Cloning into project1-remove-submodules...</span><br><span class="line">done.</span><br><span class="line">Submodule &#x27;libs/lib1&#x27; (/home/henryyan/submd/repos/lib1.git) registered for path &#x27;libs/lib1&#x27;</span><br><span class="line">Submodule &#x27;libs/lib2&#x27; (/home/henryyan/submd/repos/lib2.git) registered for path &#x27;libs/lib2&#x27;</span><br><span class="line">Cloning into libs/lib1...</span><br><span class="line">done.</span><br><span class="line">Submodule path &#x27;libs/lib1&#x27;: checked out &#x27;8c666d86531513dd1aebdf235f142adbac72c035&#x27;</span><br><span class="line">Cloning into libs/lib2...</span><br><span class="line">done.</span><br><span class="line">Submodule path &#x27;libs/lib2&#x27;: checked out &#x27;e372b21dffa611802c282278ec916b5418acebc2&#x27;</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws  cd !$</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws  cd project1-remove-submodules</span><br></pre></td></tr></table></figure>

<h2 id="Step-by"><a href="#Step-by" class="headerlink" title="Step by"></a>Step by</h2><p>1、删除git cache和物理文件夹</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-remove-submodules git:(master) git rm -r --cached libs/</span><br><span class="line">rm &#x27;libs/lib1&#x27;</span><br><span class="line">rm &#x27;libs/lib2&#x27;</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-remove-submodules git:(master) ✗ rm -rf libs</span><br></pre></td></tr></table></figure>

<p>2、删除.gitmodules的内容（或者整个文件）<br>因为本例只有两个子模块，直接删除文件：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-remove-submodules git:(master) ✗ rm .gitmodules</span><br></pre></td></tr></table></figure>

<pre><code>如果仅仅删除某一个submodule那么打开.gitmodules文件编辑，删除对应submodule配置即可。</code></pre>
<p>3、删除.git/config的submodule配置<br>源文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[core]</span><br><span class="line">    repositoryformatversion &#x3D; 0 </span><br><span class="line">    filemode &#x3D; true</span><br><span class="line">    bare &#x3D; false</span><br><span class="line">    logallrefupdates &#x3D; true</span><br><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">    fetch &#x3D; +refs&#x2F;heads&#x2F;*:refs&#x2F;remotes&#x2F;origin&#x2F;*</span><br><span class="line">    url &#x3D; &#x2F;home&#x2F;henryyan&#x2F;submd&#x2F;ws&#x2F;..&#x2F;repos&#x2F;project1.git</span><br><span class="line">[branch &quot;master&quot;]</span><br><span class="line">    remote &#x3D; origin</span><br><span class="line">    merge &#x3D; refs&#x2F;heads&#x2F;master</span><br><span class="line">[submodule &quot;libs&#x2F;lib1&quot;]</span><br><span class="line">    url &#x3D; &#x2F;home&#x2F;henryyan&#x2F;submd&#x2F;repos&#x2F;lib1.git</span><br><span class="line">[submodule &quot;libs&#x2F;lib2&quot;]</span><br><span class="line">    url &#x3D; &#x2F;home&#x2F;henryyan&#x2F;submd&#x2F;repos&#x2F;lib2.git</span><br></pre></td></tr></table></figure>

<p>删除后：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[core]</span><br><span class="line">    repositoryformatversion &#x3D; 0 </span><br><span class="line">    filemode &#x3D; true</span><br><span class="line">    bare &#x3D; false</span><br><span class="line">    logallrefupdates &#x3D; true</span><br><span class="line">[remote &quot;origin&quot;]</span><br><span class="line">    fetch &#x3D; +refs&#x2F;heads&#x2F;*:refs&#x2F;remotes&#x2F;origin&#x2F;*</span><br><span class="line">    url &#x3D; &#x2F;home&#x2F;henryyan&#x2F;submd&#x2F;ws&#x2F;..&#x2F;repos&#x2F;project1.git</span><br><span class="line">[branch &quot;master&quot;]</span><br><span class="line">    remote &#x3D; origin</span><br><span class="line">    merge &#x3D; refs&#x2F;heads&#x2F;master</span><br></pre></td></tr></table></figure>

<p>4、提交更改</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-remove-submodules git:(master) ✗ git status</span><br><span class="line"><span class="meta">#</span><span class="bash"> On branch master</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Changes to be committed:</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git reset HEAD &lt;file&gt;...&quot;</span> to unstage)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   deleted:    libs/lib1</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   deleted:    libs/lib2</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Changes not staged for commit:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git add/rm &lt;file&gt;...&quot;</span> to update what will be committed)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">   (use <span class="string">&quot;git checkout -- &lt;file&gt;...&quot;</span> to discard changes <span class="keyword">in</span> working directory)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment">#   deleted:    .gitmodules</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash">➜ henryyan@hy-hp  ~/submd/ws/project1-remove-submodules git:(master) ✗ git add .gitmodules</span></span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-remove-submodules git:(master) ✗ git commit -m &quot;删除子模块lib1和lib2&quot;</span><br><span class="line">[master 5e2ee71] 删除子模块lib1和lib2</span><br><span class="line"> 3 files changed, 0 insertions(+), 8 deletions(-)</span><br><span class="line"> delete mode 100644 .gitmodules</span><br><span class="line"> delete mode 160000 libs/lib1</span><br><span class="line"> delete mode 160000 libs/lib2</span><br><span class="line">➜ henryyan@hy-hp  ~/submd/ws/project1-remove-submodules git:(master) git push</span><br><span class="line">Counting objects: 3, done.</span><br><span class="line">Delta compression using up to 2 threads.</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (2/2), 302 bytes, done.</span><br><span class="line">Total 2 (delta 0), reused 0 (delta 0)</span><br><span class="line">Unpacking objects: 100% (2/2), done.</span><br><span class="line">To /home/henryyan/submd/ws/../repos/project1.git</span><br><span class="line">   756e788..5e2ee71  master -&gt; master</span><br></pre></td></tr></table></figure>

<h1 id="git-分离子目录并清理"><a href="#git-分离子目录并清理" class="headerlink" title="git 分离子目录并清理"></a>git 分离子目录并清理</h1><p>将现有 git 仓库中的子目录分离为独立仓库并保留其提交历史</p>
<p>参照 <a target="_blank" rel="noopener" href="https://blessing.studio/splitting-a-subfolder-out-into-a-new-git-repository/">如何将现有 git 仓库中的子目录分离为独立仓库并保留其提交历史</a>，按照 0x01-0x02-0x03-0x05 按部就班操作即可。替代方案 0x04 对于了解 <code>git filter-branch</code> 命令大有帮助。</p>
<p>核心步骤 0x03 中，注意在 <code>git subtree</code> 之后，严格按照作者给出的新建空仓库 <code>git init</code>，然后拉取临时分支操作 <code>git pull</code>。由此得到 <code>.git</code> 是干净的。</p>
<ul>
<li>如果使用原仓库，清理其余分支，再重命名临时分支，<code>.git</code> 存在垃圾内容。</li>
</ul>
<p>如果本地仓库尚未推送由他人使用，我们还可以进一步把这个子目录从原 repo 中不留一丝痕迹地完全移除。此时可以参考 GitHub Help 文章 <a target="_blank" rel="noopener" href="https://help.github.com/articles/removing-sensitive-data-from-a-repository/">Removing sensitive data from a repository</a>。</p>
<p>使用 <a target="_blank" rel="noopener" href="https://rtyley.github.io/bfg-repo-cleaner/">BFG</a> 时，可以不带任何参数以查看帮助说明：</p>
<blockquote>
<p>For further command-line options, you can run the BFG without any arguments.</p>
</blockquote>
<p>注意 BFG 作者在说明以及示例中，全部是在 <code>git clone --mirror</code> 的仓库中操作的。</p>
<p>在使用 <code>java -jar ..\bfg-1.13.0.jar  --delete-folders DLModelingProject</code> 命令之后，StockDataLayerX.git 会将所有涉及此目录的 commit 置空，然后需要我们 <a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/28313664/remove-empty-commits-in-git">Remove empty commits in git</a> —— 还是需要接触 <a target="_blank" rel="noopener" href="https://git-scm.com/docs/git-filter-branch">git-filter-branch</a>。</p>
<pre><code>git filter-branch --prune-empty --tag-name-filter cat -- --all</code></pre>
<h1 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h1><p>对于Git Submodule来说在刚刚接触的时候多少会有点凌乱的赶紧，尤其是没有接触过<strong>svn:externals</strong>。</p>
<p>本文从开始创建项目到使用git submodule的每个步骤以及细节、原理逐一讲解，希望到此读者能驾驭它。</p>
<p>学会了Git submdoule你的项目中再也不会出现大量重复的资源文件、公共类库，更不会出现多个版本，甚至一个客户的多个项目风格存在各种差异。</p>
<p>本文的写作来源于工作中的实践，如果您对于某个做法有更好的办法还请赐教，希望能留下您宝贵的意见。</p>
<h2 id="转载声明"><a href="#转载声明" class="headerlink" title="转载声明"></a>转载声明</h2><p>在转载以下文章的前提下，规范目录分级，并增加“git 分离子目录并清理” 章节。</p>
<p>原创文章，转载请注明出处！<br><a target="_blank" rel="noopener" href="http://www.kafeitu.me/git/2012/03/27/git-submodule.html">Git Submoudle使用完整教程–咖啡兔</a></p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/git/" rel="tag"># git</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/2018/01/17/gitConfig/" rel="next" title="git 常用配置">
                  <i class="fa fa-chevron-left"></i> git 常用配置
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/2018/09/06/singleton3/" rel="prev" title="单例很糟糕？">
                  单例很糟糕？ <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%BC%80%E5%A7%8B%E5%AD%A6%E4%B9%A0Git-Submodule"><span class="nav-number">1.</span> <span class="nav-text">开始学习Git Submodule</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BAGit-Submodule%E6%B5%8B%E8%AF%95%E9%A1%B9%E7%9B%AE"><span class="nav-number">1.1.</span> <span class="nav-text">创建Git Submodule测试项目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83"><span class="nav-number">1.1.1.</span> <span class="nav-text">准备环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E9%A1%B9%E7%9B%AE"><span class="nav-number">1.1.2.</span> <span class="nav-text">初始化项目</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E5%85%AC%E5%85%B1%E7%B1%BB%E5%BA%93"><span class="nav-number">1.1.3.</span> <span class="nav-text">初始化公共类库</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BA%E4%B8%BB%E9%A1%B9%E7%9B%AE%E6%B7%BB%E5%8A%A0Submodules"><span class="nav-number">1.2.</span> <span class="nav-text">为主项目添加Submodules</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BAproject1%E6%B7%BB%E5%8A%A0lib1%E5%92%8Clib2"><span class="nav-number">1.2.1.</span> <span class="nav-text">为project1添加lib1和lib2</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Clone%E5%B8%A6%E6%9C%89Submodule%E7%9A%84%E4%BB%93%E5%BA%93"><span class="nav-number">1.3.</span> <span class="nav-text">Clone带有Submodule的仓库</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9Submodule"><span class="nav-number">1.4.</span> <span class="nav-text">修改Submodule</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0%E4%B8%BB%E9%A1%B9%E7%9B%AE%E7%9A%84Submodules"><span class="nav-number">1.5.</span> <span class="nav-text">更新主项目的Submodules</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BAproject2%E6%B7%BB%E5%8A%A0lib1%E5%92%8Clib2"><span class="nav-number">1.6.</span> <span class="nav-text">为project2添加lib1和lib2</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9lib1%E5%92%8Clib2%E5%B9%B6%E5%90%8C%E6%AD%A5%E5%88%B0project1%E5%92%8Cproject2"><span class="nav-number">1.7.</span> <span class="nav-text">修改lib1和lib2并同步到project1和project2</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8lib1%E4%B8%AD%E6%B7%BB%E5%8A%A0%E4%B8%80%E4%B8%AA%E6%96%87%E4%BB%B6%EF%BC%9AREADME"><span class="nav-number">1.7.1.</span> <span class="nav-text">在lib1中添加一个文件：README</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9C%A8lib2%E4%B8%AD%E7%9A%84lib2-features%E6%96%87%E4%BB%B6%E6%B7%BB%E5%8A%A0%E6%96%87%E5%AD%97"><span class="nav-number">1.7.2.</span> <span class="nav-text">在lib2中的lib2-features文件添加文字</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%90%8C%E6%AD%A5project2%E7%9A%84lib1%E5%92%8Clib2%E7%9A%84%E4%BF%AE%E6%94%B9%E5%88%B0project1"><span class="nav-number">1.8.</span> <span class="nav-text">同步project2的lib1和lib2的修改到project1</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0project1%E7%9A%84lib1%E5%92%8Clib2%E6%94%B9%E5%8A%A8"><span class="nav-number">1.8.1.</span> <span class="nav-text">更新project1的lib1和lib2改动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0project1%E7%9A%84submodule%E5%BC%95%E7%94%A8"><span class="nav-number">1.8.2.</span> <span class="nav-text">更新project1的submodule引用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0project1-b%E9%A1%B9%E7%9B%AE%E7%9A%84%E5%AD%90%E6%A8%A1%E5%9D%97-%E4%BD%BF%E7%94%A8%E8%84%9A%E6%9C%AC"><span class="nav-number">1.9.</span> <span class="nav-text">更新project1-b项目的子模块(使用脚本)</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%89%9B%E5%88%80%E5%B0%8F%E8%AF%95"><span class="nav-number">1.9.1.</span> <span class="nav-text">牛刀小试</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%8A%E8%B7%AF"><span class="nav-number">1.9.2.</span> <span class="nav-text">上路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2013-01-19%E6%9B%B4%E6%96%B0"><span class="nav-number">1.9.3.</span> <span class="nav-text">2013-01-19更新</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%93%E9%AA%8C%E5%B7%A5%E5%85%B7%E5%B8%A6%E6%9D%A5%E7%9A%84%E4%BE%BF%E5%88%A9"><span class="nav-number">1.9.4.</span> <span class="nav-text">体验工具带来的便利</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%96%B0%E8%BF%9B%E5%91%98%E5%B7%A5%E5%8A%A0%E5%85%A5%E5%9B%A2%E9%98%9F%EF%BC%8C%E4%B8%80%E6%AC%A1%E6%80%A7Clone%E9%A1%B9%E7%9B%AE%E5%92%8CSubmodules"><span class="nav-number">1.10.</span> <span class="nav-text">新进员工加入团队，一次性Clone项目和Submodules</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E4%B8%80%E9%94%AE%E6%96%B9%E5%BC%8F%E5%85%8B%E9%9A%86project2"><span class="nav-number">1.10.1.</span> <span class="nav-text">使用一键方式克隆project2</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%A7%BB%E9%99%A4Submodule"><span class="nav-number">2.</span> <span class="nav-text">移除Submodule</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Step-by"><span class="nav-number">2.1.</span> <span class="nav-text">Step by</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#git-%E5%88%86%E7%A6%BB%E5%AD%90%E7%9B%AE%E5%BD%95%E5%B9%B6%E6%B8%85%E7%90%86"><span class="nav-number">3.</span> <span class="nav-text">git 分离子目录并清理</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%BB%93%E6%9D%9F%E8%AF%AD"><span class="nav-number">4.</span> <span class="nav-text">结束语</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BD%AC%E8%BD%BD%E5%A3%B0%E6%98%8E"><span class="nav-number">4.1.</span> <span class="nav-text">转载声明</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="tnie & ilyw"
      src="https://raw.githubusercontent.com/tnie/MarkdownPhotos/master/Baymax1.jpg">
  <p class="site-author-name" itemprop="name">tnie & ilyw</p>
  <div class="site-description" itemprop="description">家人是奋斗的初衷，路途艰辛时常思初心。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">127</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/tnie" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;tnie" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/nie7g" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;nie7g" rel="noopener" target="_blank"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">tnie & ilyw</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v5.3.0
  </div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.5.0
  </div>

        












        
      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>














  

  

</body>
</html>
